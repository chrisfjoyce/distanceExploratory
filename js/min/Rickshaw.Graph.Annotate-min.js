Rickshaw.namespace("Rickshaw.Graph.Annotate"),Rickshaw.Graph.Annotate=function(e){var n=this.graph=e.graph;this.elements={timeline:e.element};var t=this;this.data={},this.elements.timeline.classList.add("rickshaw_annotation_timeline"),this.add=function(e,n,a){t.data[e]=t.data[e]||{boxes:[]},t.data[e].boxes.push({content:n,end:a})},this.update=function(){Rickshaw.keys(t.data).forEach(function(e){var n=t.data[e],a=t.graph.x(e);if(0>a||a>t.graph.x.range()[1])return n.element&&(n.line.classList.add("offscreen"),n.element.style.display="none"),void n.boxes.forEach(function(e){e.rangeElement&&e.rangeElement.classList.add("offscreen")});if(!n.element){var i=n.element=document.createElement("div");i.classList.add("annotation"),this.elements.timeline.appendChild(i),i.addEventListener("click",function(e){i.classList.toggle("active"),n.line.classList.toggle("active"),n.boxes.forEach(function(e){e.rangeElement&&e.rangeElement.classList.toggle("active")})},!1)}n.element.style.left=a+"px",n.element.style.display="block",n.boxes.forEach(function(e){var i=e.element;if(i||(i=e.element=document.createElement("div"),i.classList.add("content"),i.innerHTML=e.content,n.element.appendChild(i),n.line=document.createElement("div"),n.line.classList.add("annotation_line"),t.graph.element.appendChild(n.line),e.end&&(e.rangeElement=document.createElement("div"),e.rangeElement.classList.add("annotation_range"),t.graph.element.appendChild(e.rangeElement))),e.end){var s=a,l=Math.min(t.graph.x(e.end),t.graph.x.range()[1]);s>l&&(l=a,s=Math.max(t.graph.x(e.end),t.graph.x.range()[0]));var r=l-s;e.rangeElement.style.left=s+"px",e.rangeElement.style.width=r+"px",e.rangeElement.classList.remove("offscreen")}n.line.classList.remove("offscreen"),n.line.style.left=a+"px"})},this)},this.graph.onUpdate(function(){t.update()})};