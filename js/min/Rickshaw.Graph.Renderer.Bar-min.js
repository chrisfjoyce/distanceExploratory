Rickshaw.namespace("Rickshaw.Graph.Renderer.Bar"),Rickshaw.Graph.Renderer.Bar=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"bar",defaults:function(t){var a=Rickshaw.extend(t(),{gapSize:.05,unstack:!1});return delete a.tension,a},initialize:function(t,a){a=a||{},this.gapSize=a.gapSize||this.gapSize,t(a)},domain:function(t){var a=t(),e=this._frequentInterval(this.graph.stackedData.slice(-1).shift());return a.x[1]+=Number(e.magnitude),a},barWidth:function(t){var a=this._frequentInterval(t.stack),e=this.graph.x(t.stack[0].x+a.magnitude*(1-this.gapSize));return e},render:function(t){t=t||{};var a=this.graph,e=t.series||a.series,r=t.vis||a.vis;r.selectAll("*").remove();var n=this.barWidth(e.active()[0]),i=0,s=e.filter(function(t){return!t.disabled}).length,c=this.unstack?n/s:n,u=function(t){var e=[1,0,0,t.y<0?-1:1,0,t.y<0?2*a.y.magnitude(Math.abs(t.y)):0];return"matrix("+e.join(",")+")"};e.forEach(function(t){if(!t.disabled){var e=this.barWidth(t),n=r.selectAll("path").data(t.stack.filter(function(t){return null!==t.y})).enter().append("svg:rect").attr("x",function(t){return a.x(t.x)+i}).attr("y",function(t){return a.y(t.y0+Math.abs(t.y))*(t.y<0?-1:1)}).attr("width",c).attr("height",function(t){return a.y.magnitude(Math.abs(t.y))}).attr("transform",u);Array.prototype.forEach.call(n[0],function(a){a.setAttribute("fill",t.color)}),this.unstack&&(i+=c)}},this)},_frequentInterval:function(t){for(var a={},e=0;e<t.length-1;e++){var r=t[e+1].x-t[e].x;a[r]=a[r]||0,a[r]++}var n={count:0,magnitude:1};return Rickshaw.keys(a).forEach(function(t){n.count<a[t]&&(n={count:a[t],magnitude:t})}),n}});