Rickshaw.namespace("Rickshaw.Graph.Renderer.Multi"),Rickshaw.Graph.Renderer.Multi=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"multi",initialize:function(r,e){r(e)},defaults:function(r){return Rickshaw.extend(r(),{unstack:!0,fill:!1,stroke:!0})},configure:function(r,e){e=e||{},this.config=e,r(e)},domain:function(r){this.graph.stackData();var e=[],n=this._groups();this._stack(n),n.forEach(function(n){var t=n.series.filter(function(r){return!r.disabled}).map(function(r){return r.stack});if(t.length){var i=r(t);e.push(i)}});var t=d3.min(e.map(function(r){return r.x[0]})),i=d3.max(e.map(function(r){return r.x[1]})),a=d3.min(e.map(function(r){return r.y[0]})),s=d3.max(e.map(function(r){return r.y[1]}));return{x:[t,i],y:[a,s]}},_groups:function(){var r=this.graph,e={};r.series.forEach(function(n){if(!n.disabled){if(!e[n.renderer]){var t="http://www.w3.org/2000/svg",i=document.createElementNS(t,"g");r.vis[0][0].appendChild(i);var a=r._renderers[n.renderer],s={},c=[this.defaults(),a.defaults(),this.config,this.graph];c.forEach(function(r){Rickshaw.extend(s,r)}),a.configure(s),e[n.renderer]={renderer:a,series:[],vis:d3.select(i)}}e[n.renderer].series.push(n)}},this);var n=[];return Object.keys(e).forEach(function(r){var t=e[r];n.push(t)}),n},_stack:function(r){return r.forEach(function(r){var e=r.series.filter(function(r){return!r.disabled}),n=e.map(function(r){return r.stack});if(!r.renderer.unstack){var t=d3.layout.stack(),i=Rickshaw.clone(t(n));e.forEach(function(r,e){r._stack=Rickshaw.clone(i[e])})}},this),r},render:function(){this.graph.series.forEach(function(r){if(!r.renderer)throw new Error("Each series needs a renderer for graph 'multi' renderer")}),this.graph.vis.selectAll("*").remove();var r=this._groups();r=this._stack(r),r.forEach(function(r){var e=r.series.filter(function(r){return!r.disabled});e.active=function(){return e},r.renderer.render({series:e,vis:r.vis}),e.forEach(function(r){r.stack=r._stack||r.stack||r.data})})}});